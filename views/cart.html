<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>幸福鲜生-购物车</title>
	<link rel="stylesheet" type="text/css" href="/static/css/reset.css">
	<link rel="stylesheet" type="text/css" href="/static/css/main.css">
	<script type="text/javascript" src="/static/js/jquery-1.12.4.min.js"></script>
	<script type="text/javascript">
		const emptyHtmlStr = "<div style=\"margin: 0 auto;text-align: center;padding: 35px 0\"><span style=\"font-size: 1.2em\">购物车空空如也</span></div>"

		let del = id => {
			$.ajax({
				url: "/cart/delete/" + id,
				type: "get",
				dataType: "json",
				success: msg => {
					msg = $.parseJSON(msg)
					if (msg.Success === true) {
						$("#cart-" + id).remove();
						calculateTotal();
						if ($(".cart_list_td").length === 0) {

						}
					}
				}
			})
		}

		let editNum = (id, op) => {
			// 为1时不能再减
			if (op === "minus" && $("#num-" + id).val() === '1') {
				return;
			}
			$.ajax({
				url: "/cart/edit/" + id,
				type: "get",
				data: {"op": op},
				dataType: "json",
				success: msg => {
					msg = $.parseJSON(msg);
					if (msg.Success === true) {
						$("#num-" + id).val(msg.Data)
						$("#t-price-" + id)[0].innerText = msg.Data * Number($("#price-" + id)[0].innerText.replace("元", "")) + "元";
						calculateTotal()
					}
				}
			})
		};

		$(() => {
			calculateTotal();
		});

		let calculateTotal = () => {
			let priceEle = $(".col07");
			let totalPrice = 0.00;
			for (let i = 0; i < priceEle.length; i++) {
				totalPrice += Number(priceEle[i].innerText.replace("元", ""));
			}
			$("#total")[0].innerHTML = totalPrice;
		}
	</script>
</head>
<body>
	{{template "header.html" .}}

	<div class="search_bar clearfix">
		<a href="/" class="logo fl"><img src="/static/images/logo.png"></a>
		<div class="sub_page_name fl">|&nbsp;&nbsp;&nbsp;&nbsp;购物车</div>
		<div class="search_con fr">
			<input type="text" class="input_text fl" name="" placeholder="搜索商品">
			<input type="button" class="input_btn fr" name="" value="搜索">
		</div>
	</div>

	<div class="total_count">全部商品<em>{{ len .Carts }}</em>件</div>
	<ul class="cart_list_th clearfix">
		<li class="col01">商品名称</li>
		<li class="col02">商品单位</li>
		<li class="col03">商品价格</li>
		<li class="col04">数量</li>
		<li class="col05">小计</li>
		<li class="col06">操作</li>
	</ul>

	{{ range $i, $cart := .Carts }}
		<ul id="cart-{{ $cart.Id }}" class="cart_list_td clearfix">
			<li class="col01"><input type="checkbox" name="" checked></li>
			<li class="col02"><img src="/static/images/goods/{{ $cart.Item.Pic }}"></li>
			<li class="col03">{{ $cart.Item.Name }}<br><em>{{ $cart.Item.Price }}元/{{ $cart.Item.Unit }}</em></li>
			<li class="col04">{{ $cart.Item.Unit }}</li>
			<li class="col05" id="price-{{ $cart.Id }}">{{ $cart.Item.Price }}</li>
			<li class="col06">
				<div class="num_add">
					<a href="javascript:editNum({{ $cart.Id }}, 'add')" class="add fl">+</a>
					<input id="num-{{ $cart.Id }}" type="text" class="num_show fl" value="{{ $cart.Num }}">
					<a href="javascript:editNum({{ $cart.Id }}, 'minus');" class="minus fl">-</a>
				</div>
			</li>
			<li class="col07" id="t-price-{{ $cart.Id }}">{{ $cart.TotalPrice }}元</li>
			<li class="col08"><a href="javascript:del({{ $cart.Id }});"><span style="color: red">删除</span></a></li>
		</ul>
	{{ else }}
		<div style="margin: 0 auto;text-align: center;padding: 35px 0"><span style="font-size: 1.2em">购物车空空如也</span></div>
	{{ end }}
	

	<ul class="settlements">
		<li class="col01"><input type="checkbox" name="" checked=""></li>
		<li class="col02">全选</li>
		<li class="col03">合计(不含运费)：<span>¥</span><em id="total">0.00元</em><br>共计<b>{{ len .Carts }}</b>件商品</li>
		<li class="col04"><a href="place_order.html">去结算</a></li>
	</ul>

	{{template "footer.html" .}}
</body>


</html>